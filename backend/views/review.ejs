<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PeerView - Review <%= project ? project.title : 'Project' %></title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/style.css" rel="stylesheet">
</head>
<body class="bg-light">
    <%- include('partials/navbar', { user: user }) %>
    <div class="container mt-5">
        <h2 class="text-center mb-4">Reviews for: <%= project ? project.title : 'Unknown Project' %></h2>
        <p class="text-center">By <%= project && project.owner ? project.owner.username : 'Unknown User' %>: <%= project ? project.description : 'No description available' %></p>
        <% if (project && project.fileUrl) { %>
            <p class="text-center"><a href="<%= project.fileUrl %>" class="btn btn-outline-primary" download>Download Project File</a></p>
        <% } %>
        <hr>
        <div class="mb-4">
            <% if (reviews.length === 0) { %>
                <p class="text-center text-muted">No reviews yet. Be the first to review!</p>
            <% } else { %>
                <% reviews.forEach(r => { %>
                    <div class="card mb-3 shadow-sm">
                        <div class="card-body">
                            <h6><%= r.reviewer ? r.reviewer.username : 'Anonymous' %>:</h6>
                            <p>Clarity: <%= r.clarity %>/5 | Creativity: <%= r.creativity %>/5 | Technicality: <%= r.technicality %>/5<br>
                            Average: <%= (r.averageRating || 0).toFixed(1) %><br>
                            Comment: <%= r.comment %></p>
                        </div>
                    </div>
                <% }); %>
            <% } %>
        </div>
        <div class="card shadow">
            <div class="card-header"><h5>Submit Your Review</h5></div>
            <div class="card-body">
                <form action="/submit-review" method="POST" onsubmit="return validateReview()">
                    <input type="hidden" name="project" value="<%= project ? project._id : '' %>">
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label for="clarity" class="form-label">Clarity (1-5)</label>
                            <input type="number" class="form-control" id="clarity" name="clarity" min="1" max="5" required>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="creativity" class="form-label">Creativity (1-5)</label>
                            <input type="number" class="form-control" id="creativity" name="creativity" min="1" max="5" required>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="technicality" class="form-label">Technicality (1-5)</label>
                            <input type="number" class="form-control" id="technicality" name="technicality" min="1" max="5" required>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="comment" class="form-label">Comment</label>
                        <textarea class="form-control" id="comment" name="comment" rows="3" required></textarea>
                    </div>
                    <button type="submit" class="btn btn-success w-100">Submit Review</button>
                </form>
            </div>
        </div>
        <div class="text-center mt-4"><a href="/projects" class="btn btn-secondary">Back to Projects</a></div>
    </div>
    <script>
        function validateReview() {
            const clarity = parseInt(document.getElementById('clarity').value);
            const creativity = parseInt(document.getElementById('creativity').value);
            const technicality = parseInt(document.getElementById('technicality').value);
            if (isNaN(clarity) || clarity < 1 || clarity > 5 || 
                isNaN(creativity) || creativity < 1 || creativity > 5 || 
                isNaN(technicality) || technicality < 1 || technicality > 5) {
                alert('Ratings must be between 1 and 5');
                return false;
            }
            if (!document.getElementById('comment').value.trim()) {
                alert('Comment is required');
                return false;
            }
            return true;
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>